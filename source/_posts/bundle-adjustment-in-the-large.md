title: Bundle Adjustment in the Large
date: 2016-08-09 19:04:03
categories: Translation
tags: [computer vision]
---

　　初步简略翻译中，稍后订正，未完待续...

<!--more-->

> **Abstract.** 我们展示了设计和应用针对成千上万张图像的大规模BA问题，提出了一种新的不精确性牛顿方法。我们探索了利用共轭梯度求解牛顿法和它的性能作为一些简单且计算高效的预条件子的函数。我们显示普通的Schur complement trick并不局限于基于因式分解的方法，它也可以演绎为一种预处理的形式。利用街景图像数据集和若干社交图像集，我们产生了各种各样的BA问题，利用它们去评估了六种不同BA算法的性能。我们的实验表明，不精确性牛顿法，结合一些相对简单地预条件子时，在处理大规模的BA时，会带来最优的性能。相关代码、测试用例和具体的评测数据都可以在[http://grail.cs.washington.edu/projects/bal](http://grail.cs.washington.edu/projects/bal)上获取到。

> **Key words:** Structure from Motion, Bundle Adjustment, Preconditioned Conjugate Gradients

---

### **1 Introduction**
　　近年来在Structure from Motion(SfM)的相关研究表明了从大规模的社交照片集中重建几何信息的可能性[1-3]。Bundle adjustment(BA),结合相机和点参数的非线性优化，是大多数SfM的关键一步，而且在大规模场景中消耗了大量的时间。随着在这种数据集中的照片数量持续增加到成千上百张甚至百万张，BA算法的可伸缩性成为了决定性的问题。

　　BA问题的基本数学原理是很容易被理解的[4],而且目前也存在一个免费可用的高质量应用——SBA[5]。SBA是基于对reduced相机矩阵进行稠密的Cholesky分解,它具有O(n2)的空间复杂度和O(n3)的时间复杂度。它可以很好地解决只具有几百张图像的小规模问题，但对于成千上万张图像，它的代价显得过于昂贵。

---

![Fig.1](/img/figure1-baitl.png)

　　除了文献[6-8,1,9]做过一些贡献以外，大规模BA算法的发展在计算机视觉领域还没有受到过明显的关注。我们相信这是因为直到现在大规模的SfM问题的主要来源一直是视频和结构化的数据集，比如街景级别的图像和航空影像。对于这些数据集，连接图——例如，图中每张照片是一个节点，如果两张照片存在公共的区域则表明两者是联通的——是极其稀疏的，大多数具有一个大直径的带状对角矩阵结构。例如，在架设在一个汽车沿着道路前行的相机所获取的照片数据，即使只有几秒的间隔，相邻图片也几乎没有重叠区域。Figure1(a)显示了这样的一个图结构。因此，那些集中于重建中最近被修改的部分来减少BA问题的尺寸是相当高效的[7,6]。

　　社交图像集的连通图是很少有结构性的，有一个明显更小的直径，因为它们倾向于展现最受欢迎的地标，而不是一个长的、扩展性的视野序列。Figure 1(b显示了从Flickr下载来的Dubrovnik城市的照片集合的图结构。Figure 1(a)中的数据集具有结构性，它具有一个带状对角结构，98%的稀疏度，相比而言，Dubrovnik的图结构则仅有84%的稀疏度，具有一个明显更复杂的结构。这也意味着，即使Figure 1(a)中的数据集比Figure 1(b)多了基于1800张图片，但是前者求解其缩减的相机矩阵的稀疏分解比后者要少耗费40X的时间。

　　在这篇论文中，我们展示了一种新的不精确性牛顿法BA算法的设计和实现，利用了明显更少的时间和内存相比标准的基于Schur complement的算法，并且并没有损失求解质精度。我们探索了利用共轭梯度算法求解牛顿类型和它作为一些简单而且计算高效的预条件子的函数的性能。我们也显示了Schur complement并不局限于基于因式分解的方法，它是如何用于部分共轭梯度算法，而且事实上在内存中计算和存储它时，并不会带来计算代价，以及它时怎样等同于一个特定的预条件子的。

　　我们进行了大量的实验在结构性和非结构性的各种各样的问题复杂度的数据集上，也提供了基于这些实验的推荐。这篇文章中相关代码、测试用例和具体的性能测试结果都可以在[http://grail.cs.washington.edu/projects/bal](http://grail.cs.washington.edu/projects/bal)上获取到。

　　论文的其余部分的组织结构如下。在Section 2，我们简短地回顾了一些通用的非线性最小二乘问题，Levenberg Marquardt(LM)算法和Schur complement trick。在Section 3，我们介绍了非精确性LM算法。在Section 4，我们讨论了预处理共轭梯度（Conjugate Gradients, CG)算法的各种方法。在Section 5，我们则报告了进行的实验结果。在Section 6我们进行了最后的总结和讨论。

---

### **2 Bundle Adjustment**

　　给定一系列测量好的图像特征点坐标和对应点坐标，BA的目标就是去寻找到3D点坐标和相机参数，来最小化投影误差。这个优化问题通常可以描述为一个非线性最小二乘问题，这里的误差就是在观测的特征点坐标和相机图像平面的3D点坐标之间的差的二次L2范式。然而，我们并不局限于去利用L2范式；甚至当Huber's范式这样的鲁棒的损失函数被使用时，这个问题可以被转换为再加权的非线性最小二乘问题。因此下文中我们将利用这个术语bundle adjustment(BA)去替代特定的非线性最小二乘问题。

##### **2.1 Levenberg Marquardt Algorithm**

　　Levenberg Marquardt(LM)算法[11]是最流行的解决非线性最小二乘问题的算法，也是BA问题的可选算法。在本节中，我们开始简单回顾一下LM算法，然后去描述在BA问题中能大幅度地降低LM算法的Schur complement trick。读者感兴趣的话，在文献[11-14]这些优秀的参考资料中有关于LM算法更多的细节。

　　让x属于Rn成为n维的向量,F(x) = [f1(x),...,fm(x)]T成为x的m维函数.我们现在旨在解决下述优化问题,
> minx 1/2||F(x)||2.                          (1)

　　F(x)的雅克比矩阵J(x)是一个mxn维的矩阵,其中Jij(x) = ojfj(x),梯度向量g(x) = Delta1/2||F(x)||2 = J(x)TF(x).

　　解决非线性优化问题的一般策略是去解决对原始问题的一系列估计[11].在每次迭代过程中,估计被解决考决定相对向量x的一个纠正量Deltax.对于非线性最小二乘而言,一个估计可以被构建通过利用线性化F(x+Deltax) ~= F(x) + J(x)Deltax,这样就会转变为下列的最小二乘问题:
> minDeltax 1/2||J(x)Deltax + F(x)||2                            (2)

不幸的是,原始地去解决这些问题的一个序列,更新x <- x+Deltax会导致算法不收敛.为了得到一个收敛的算法,我们需要去控制这个迭代Deltax的大小.一个解决方案是去引入一个归一项:
> minDeltax 1/2||J(x)Deltax + F(x)||2 + u||D(x)Deltax||2.         (3)

这里,D(x)shiyige非负对角阵,典型的是矩阵J(x)TJ(x)的对角的平方根,u则是控制归一化的非负参数.很容易看出||Deltax||是与u成倒数相关的.LM在每步迭代中更新u的值,基于雅克比矩阵J(x)估计F(x)的情况.估计的质量通过评价目标函数的实际的减小比例,在线性模型L(Deltax) = 1/2||J(x)Deltax + F(x)||2.这是一种基于信赖阈的方法,LM是一种早期的例子[11].

　　在LM算法中每次迭代的控制计算代价就是去解决方程(3)中的线性最小二乘问题.一般而言,中小规模的最小二乘问题的,推荐去解决(3)式的方法是采用QR分解[13].然而,BA问题有一个非常特殊的结构,更高效的解决方案是去求解式(4).

#### **2.2 The Schur Complement Trick

　　我们首先从引入归一化的海森矩阵Hu(x) = J(x)TJ(x) + uD(x)TD(x)俩进行介绍.很容易看出,对于uD(x) > 0,Hu是一个对称正定阵,(3)式的求解可以通过求解一般方程:
> Hu(x)Deltax = -g(x).                                              (4)

现在,假定SfM问题由p个相机和q个点组成,而且变量x有分块结构x = [y1,...,yp,z1,...,zq].这里y和z分别对应相机和点参数.更多地,让相机部分尺寸c,点部分尺寸s(对大多数问题而言,c = 6-9, s = 3).

　　在大多数情况下,BA问题的关键特性是不存在项fi同时包含两个或以上的相机和点部分.也就是说,在目标函数中的每项fi(x)都可以被改写为fi(x) = fi(y(i), z(i)),其中y(i)和z(i)分别是出现在第i项中的相机部分和点部分.反过来这也意味着矩阵Hu可以改写为下面的形式
> Hu = [B E ET C],                                                    (5)

其中B属于Rpcxpc是一个分块对角阵,有p个尺寸为cxc的分块,C属于Rqsxqs是一个分块对角阵,有q个尺寸为sxs的分块.E属于Rpcxqs是一个普通分块稀疏阵,对每个观测而言都有一个尺寸为cxs的区块.现在我们

