title: VIO课程笔记（第3讲）
date: 2019-06-30 22:57:07
categories: Algorithm

tags: [computer vision, slam]
---

　　[深蓝学院《从零开始手写VIO》](http://www.shenlanxueyuan.com/course/160)课程笔记——第3讲：基于优化的IMU与视觉信息融合
<!-- more -->
## Section 1 - 基于Bundle Adjustment的VIO融合

### 1. 视觉SLAM里的Bundle Adjustment问题

- 已知：
  1. 状态量初始值：特征点的三维坐标、相机的位姿
  2. 系统测量值：特征点在不同图像上的图像坐标
- 问题：如何估计状态量的最优值？
- 解决方式：构建误差函数，利用最小二乘得到状态量的最优估计

## Section 2 - 最小二乘问题的求解

### 1. 最小二乘基础概念

- 定义
- 损失函数泰勒展开
  - 雅可比矩阵
  - 海塞矩阵
- 损失函数泰勒展开性质
- 求解法
  - 直接解
  - 迭代下降法

### 2. 迭代下降法求解：下降法

- 最速下降法：适用于迭代的开始阶段
  - 缺点：最优值附近震荡，收敛慢
- 牛顿法：适用于最优值附近
  - 缺点：二阶导矩阵计算复杂
- 阻尼牛顿法：限制不要走的太远

### 3. 非线性最小二乘

- Gauss-Newton和LM
- LM中阻尼因子的作用
- 阻尼因子初始值的选取
  - 韦达定理：矩阵特征值的和为矩阵的迹
- 阻尼因子$ \mu $的更新策略
  - 定性分析
  - 定量分析
- Marquardt策略
- Nielsen策略（被g2o、Ceres采用）

### 4. 鲁棒和函数的实现

- 最小二乘outlier如何处理？
- Triggs Correction（g2o、Ceres）
- （M-Estimation）
- Cauchy Cost Function

### 5. 核函数拓展

- 核函数控制参数的设定
  - 残差正态分布
  - 残差非正态分布

### 6. 回顾最小二乘求解

- 步骤：
  1. 找到一个合适的关于状态量x的残差函数f（x），后续用r、err等表示
  2. 计算残差函数对状态量x的雅可比J
  3. 选定cost function以及其参数
  4. LM算法求解

## Section 3 - VIO残差函数的构建

### 1. 系统需要优化的状态量

- 系统状态量（15维向量）

### 2. 视觉重投影误差

- 视觉重投影误差（三维）
- 逆深度参数化（一维）
  - 有些点非常远（更新量很小）
  - 参数量少
  - 逆深度更像高斯分布一些
- VIO中基于逆深度的重投影误差（T = [R， t，0，1]）

### 3. IMU测量值积分

- 每次q优化更新后，都需要重新进行积分，运算量较大

### 4. IMU预积分

- 公式转换
- 预积分量：仅仅跟IMU测量值有关，它将一段时间内的IMU数据直接积分起来就得到了预积分量
- $ \alpha 、\beta、q $，物理意义上的位移、速度和旋转
- 重新整理下PVQ的积分公式

### 5. IMU的预积分误差

- 预积分误差（一段时间内IMU构建的预积分量作为测量值，对两时刻之间的状态量进行约束）
  - 位移、速度和偏置都是直接相减，第二项是关于四元数的旋转误差
  - 15维向量
- 预积分的离散形式
  - 欧拉法
  - 中值法
  - RK4

### 6. 预积分量的方差

- 一个IMU数据作为测量值的噪声方差我们能够标定。现在，一段时间内多个IMU数据积分形成的预积分量的方差呢？
- Covariance Propagation
- 所以，要推导预积分量的协方差，我们需要知道IMU噪声和预积分量之间的线形递推关系
- 假设已知了相邻时刻误差的线形传递方程，误差的传递由两部分组成：当前时刻的误差传递给下一时刻，当前时刻测量噪声传递给下一时刻

### 7. 状态误差线形递推公式的推导

- 两种方法来推导状态误差传递的线形递推关系
  1. 一种是基于一阶泰勒展开的误差递推方程
  2. 一种是基于误差随时间变化的递推方程

### 8. 基于一阶泰勒展开的误差递推方程

- 基于泰勒展开的误差传递（应用于EKF的协方差预测）

### 9. 基于误差随时间变化的递推方程

- 传递方程
- 两种方法对比？
- 一般VIO中采用第二种（基于误差随时间变化的递推方程），因为VIO系统中已经知道了状态的倒数和状态之间的转移矩阵，就可以推导误差和状态误差之间的关系？

### 9. 预积分的误差递推公式推导

- 预积分误差传递的形式（F、G为两个时刻间的协方差传递矩阵）
- 雅可比矩阵F、G的推导

### 10. 雅可比矩阵F、G的推导

- B对各状态量的雅可比推导（第三行）

## Section 4 - 残差Jacobian的推导（整个系统）

### 1. 视觉重投影残差的Jacobian

### 2. IMU误差相对于优化变量的Jacobian

- IMU角度误差相对优化变量的Jacobian