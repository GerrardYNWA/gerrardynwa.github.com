title: 视觉SLAM十四讲——回环检测
date: 2018-01-09 16:32:42
categories: Algorithm

tags: [computer vision, slam]
---
　　重新整理学习《视觉SLAM十四讲》：回环检测
<!-- more -->

### 1. 回环检测与词袋

#### 1.1 回环检测的意义

- VO和后端都存在误差
- SLAM的建图与定位是耦合的——误差将会累积（单目：R、t和Scale，Sim(3)）

#### 1.2 Loop Closing步骤

1. 检测到回环的发生
2. 计算回环候选帧与当前帧的运动
3. 验证回环是否成立
4. 闭环

### 1.3 如何检测回环是否发生——回环检测

- 最简单的方法：对任意两个关键帧进行特征匹配
- 基于里程计的方法（Odometry based）（假设累积误差不大，逻辑有点矛盾）
- 基于外观的方法（Appearance based）（摆脱了累积误差，使得回环检测模块相对独立）
  - 外观的方法是主流
  - 核心在于衡量图像间的相似性
  - 朴素的想法：灰度相减$ s(A, B) = ||A - B|| $
  - 像素灰度是一种不稳定的测量值，严重受光照和相机曝光的影响。另外，当相机视角发生少量变化时，会有很大的差异值。

#### 1.4 回环检测指标

- Perceptual Aliasing（感知偏差，假阳性，FP）

- Perceptual Variability（感知变异，假阴性，FN）

- | 算法\事实 |          是回环          |         不是回环         |
  | :-------: | :----------------------: | :----------------------: |
  |  是回环   | 真阳性（True Positive）  | 假阳性（False Positive） |
  | 不是回环  | 假阴性（False Negative） | 真阴性（True Positive）  |

#### 1.5 ROC曲线（Precision-Recal曲线）

- Precision = TP / (TP + FP)，Recall = TP / (TP + FN)
- Precision和Recall通常是矛盾的，P高则R低，R高则P低

#### 1.6 Appearance-based主要方法：词袋

- Bag-of-Words，BoW
- BoW是对特征的聚类
  - 特征聚类形成了Word
  - 许多Word组成了Dictonary
  - 图像的相似性 = Word的相似性
  - 只看Word的有无，无视Word的顺序

#### 1.7 Word的形成

- 聚类（无监督的机器学习）
- 经典的k-means聚类，N个特征点->k个类
  1. 随机选取k个中心点：$ c_1, … , c_k $
  2. 对每一个样本，计算它与每个中心点之间的距离，取最小的作为它的归类
  3. 重新计算每个类的中心点
  4. 如果每个中心点都变化很小，则算法收敛，退出；否则返回第2步。

#### 1.8 字典的结构

- 当实际拿到一个特征时，需要查询它对应的Word是什么
- 遍历比较：$ O(n) $
- 简历字典结构可以加速比较
- k-d tree：$ k $分支数，$ d $层
- $ k^d $个Word，$ d $次比较，$ O(kd) $

#### 1.9 相似度计算

- 原则上比较Word即可计算图像相似度
- 但一些Word很常见，另一些则很罕见
- TF-IDF（Term Frequency-Inverse Document Frequency）
  - 思路：单词在字典中出现频率越高，则区分度越低；在图像中频率越高，则区分度越高
  - IDF部分可在字典训练过程中计算
  - TF部分则需要对图像的特征进行计算

#### 1.10 SLAM中的回环检测

- 使用相对的评分而非绝对的评分
- 思路：相邻关键帧是相似的，而回环的相似度应该约等于相邻关键帧
- 检测成功以后：
  - 根据PnP等算法计算运动关系
  - 根据重投影关系验证回环是否成立
  - 利用全局BA或Pose Graph进行优化