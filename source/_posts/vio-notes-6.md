title: VIO课程笔记（第6讲）
date: 2019-07-24 23:52:28
categories: Algorithm

tags: [computer vision, slam, vio]
---
　　[深蓝学院《从零开始手写VIO》](http://www.shenlanxueyuan.com/course/160)课程笔记——第6讲：前端Front-end
<!-- more -->
## Section 1 - 前端的工作

### 1. SLAM的框架

- 前端：提取特征点，追踪相机Pose，定位相机
- 后端：提供全局优化或滑动窗口优化

### 2. 一些现实的问题

- 前端的步骤？初始化、正常追踪、丢失处理
- 相机和路标的建模和参数化
  - 可能的路标：绝对坐标xyz、逆深度$ \rho $、灰度值（灰度值Pattern）
- 关键帧？
  - 需不需要？
  - 怎么选？
  - 控制关键帧数量？
  - 仅在关键帧中补充新特征点？还是对所有帧提取新特征点？
  - 何时进行三角化？

### 3. 前端VS后端

- 实际上，前端非常能体现一个SLAM的追踪效果
- 在实现上，尽管后端存在明显的理论差异，但很难直观体验在最终精度上
- 假设给定相同的Pose和Landmark，给定噪声范围，各种方法是否有明显差异？还是仅仅有理论性质上的差异？

### 4. 后端的差异

```
	1. 实际情况里理论假设有多远？（假设高斯分布）
```

2. 拿到的数据究竟有多好？

- 在很多实际场合，很难回答某种后端算法是否明确优于另一种
- 例如：ORB-SLAM2使用Covisibility-Graph，DSO使用带边缘化的滑动窗口，Tango使用MSCKF，等等。
- 实验效果：ORB-SLAM2具有较好的全局精度，但无回环时DSO具有漂移较少。Tango计算量明显少于其他算法。
- **算法的结果和数据集关系很大**。例如：Kitti属于比较简单的（视野开阔、动态物体少、标定准确），EUROC一般（人工设定场景，纹理丰富，但曝光有变化），TUM-Mono比较难（场景多样，主要为真实场景）
- 总之，更多地考量计算和精度的trade-off

### 5. 前端的差异

- 追踪算法是否很容易丢失？
- 算法对干扰的鲁棒性如何（光照、遮挡、动态物体）？
- 前端更多是范式之间的比较，而非范式之内的比较
- 好的前端
  - 追踪效果好，不容易丢
  - 计算速度快
  - 累计误差小
- 不好的前端
  - 追踪效果差
  - 计算耗时
  - 容易出现累计误差
- VO方法的定性比较
  - 效果VS耗时
- 几个要点
  - 光流法最早、最成熟，缺点也明显（抗光照干扰弱，依赖角点）
  - FAST+光流式比较实用的快速算法/GFTT+光流效果更好，也具备实时性
  - 特征匹配需要提的特征具有旋转平移缩放不变性，SIFT/SUFT是最好的一类，BRISK等次之，ORB算比较差的
  - 特征匹配和光流都非常依赖角点，日常生活场景中角点不明显的很多
  - 直接法不依赖角点，但实现效果根据选点数量变化较大

## Section 2 - 特征点提取、匹配和光流

### 1. 特征点提取

- 一个传统的双目光流前端流程
- 除了正常追踪流程之外，还需要考虑初始化、丢失恢复的情况
- VIO初始化比常规VO多一些步骤（主要为IMU参数的估计）
- 为什么要有这样的框架？（工程经验使然）
- 在光流中，我们通常选择角点来追踪。为什么需要角点？
- 角点的梯度在两个方向都有分布，利用角点附近块的两个特征值大小，可以判断该区是否为角点
- FAST/GFTT角点
  1. FAST：仅含像素亮度、不含计算的快速角点提取方式
  2. GFTT：在Harris基础上改进：Shi-Tomasi分数，增加固定选点数等等

### 2. 光流

- 光流可以追踪一个时刻的角点在下一时刻的图像位置
- 灰度不变假设：一阶Taylor展开
- 带Warp Function的光流：通常取仿射变换，W的参数需要在线估计
- 金字塔式光流
  - Coarse-to-Fine：从顶层最模糊的图像开始计算光流，一直往下迭代到最高分辨率
- 光流在SLAM中的作用
  1. 光流可以追踪上一帧的角点
  2. 可以一直追踪该角点，直到超出图像范围或被遮挡
  3. 在单目SLAM中，新提出的角点没有3D信息，因此可通过追踪角点在各图像位置，进行三角化
- 光流的局限性
  1. 容易受光照变化影响
  2. 只适合连续图像中的短距离追踪，不适合更长距离
  3. 图像外观发生明显变化时不适用（例：远处的角点凑近看之后不为角点了）
  4. 对角点强依赖，对Edge类型点表现较差
  5. 稀疏光流不约束各点光流的方向统一，可能出现一些outlier

## Section 3 - 关键帧与三角化

### 1. 关键帧

- 为什么需要关键帧？
  1. 后端通常实时性较差，不适合处理所有帧
  2. 如果相机停止，可能给后端留下无用的优化，甚至导致后端问题退化
     - 逆深度的参数化，不可观，会多出来一个自由度
- 如何选择关键帧？
  1. 关键帧之间不必太近（退化或三角化问题）
  2. 关键帧之间不能太远（共视点太少）
  3. VIO，定期选择关键帧（假设$ b_g $、$ b_a $在关键帧期间不变）
- 关键帧策略：在计算量允许范围内，且不引起退化时，应尽可能多地插入关键帧
  1. 对于非关键帧，只执行前端算法，不参与后端优化
  2. 因此，对于非关键帧，它的误差会逐渐累积。直到该帧被作为关键帧插入后端，BA才会保证窗口内的一致性
- 例子：ORB-SLAM2
  - 使用非常宽松的关键帧策略（大多数时候只要后端线程Idle，就会插入关键帧），然后在后端剔除冗余的关键帧
- 例子：DSO
  - 利用光度误差插入关键帧（插入比较频繁）。然后在后端计算每个关键帧的Active Landmarks，Marg对窗口贡献最低的（窗口有一定的展开，关键帧尽可能地多）
  - 因此DSO的关键帧窗口通常有一个很远的和两三个很近的，其他几个分布在中间

### 2. 三角化

- 在单目SLAM中，通常在插入关键帧时计算新路标点的三角化
  - 有的SLAM系统在关键帧时提取新的Feature（DSO、SVO），也有的方案对每个帧都提新Feature（VINS、ORB）
  - 前者节省计算量（非关键帧无需提点，节省5-10ms左右）；后者效果好（在单目例需要防止三角化Landmark数量不够）
- 三角化的数学描述
  1. 考虑某路标点y在若干关键帧k = 1, … ,n